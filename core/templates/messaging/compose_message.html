<!-- In messaging/compose_message.html -->

{% extends 'base_dashboard.html' %}
{% load static %}
{% load tailwind_tags %}
{% load heroicons %}

{% block title %}Compose Message{% endblock %}

{% block dashboard_content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Compose Message</h1>

    <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
        <div class="p-6">
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label for="recipient_search" class="block text-sm font-medium text-gray-700 dark:text-gray-300">To:</label>
                    <input type="text" id="recipient_search" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Search for employee...">
                    <select name="recipient" id="recipient" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="">Select recipient</option>
                    </select>
                </div>
                <div>
                    <label for="subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Subject:</label>
                    <input type="text" name="subject" id="subject" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Message:</label>
                    <textarea name="content" id="content" rows="6" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                </div>
                <div>
                    <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Send Message
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('recipient_search');
        const recipientSelect = document.getElementById('recipient');

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value;
            if (searchTerm.length > 2) {
                fetch(`/search-employees/?term=${searchTerm}`)
                    .then(response => response.json())
                    .then(data => {
                        recipientSelect.innerHTML = '<option value="">Select recipient</option>';
                        data.forEach(employee => {
                            const option = document.createElement('option');
                            option.value = employee.id;
                            option.textContent = `${employee.full_name} (${employee.employee_id})`;
                            recipientSelect.appendChild(option);
                        });
                    });
            }
        });
    });
</script>
{% endblock %}